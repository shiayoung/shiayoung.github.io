---
title: "Kafka 客户端连接配置"
date: "2020-05-11T20:00:00"
draft: false
tags: ["kafka"]
categories: ["基础组件"]
---

### acks 消息验证（消息发送成功的判断）

- -1  Full ISR   leader & all follower 接收
-  0  leader
-  1  消息发送即可（fire and forget）

### retries 重试次数！！！
在 kafka 中可能会遇到各种各样的异常，但是无论哪种异常，都说明消息发送出现了问题，特别是网络原因导致的问题，但是集群中不可能每次异常都抛出，可能下一秒网络就恢复了，所以我们要设置重试机制。默认值是 3。

设置了 retries 之后，集群中 95% 的异常都会被处理好。

retries 一般设置 3-10 次是合理的，还可以设置重试间隔时间（参数是 retry.backoff.ms）

### batch.size 批次大小
批次的大小默认是 16K，这里设置了 32K，设置大一点可以稍微提高吞吐量。设置这个批次大小还和消息大小有关，假设一条消息的大小为 16K，一个批次大小也是 16K，这样的话批次大小的设置就失去意义了。所以我们要事先估算一下发往集群中消息的大小，正常来说都会设置成正常消息大小的 N 倍。

### linger.ms 发送倒计时
比如我现在设置 batch.size 为 32K，而一条消息是 2K，此时客户端已经有了 3 条消息发送过来，总大小为 6K，而客户端这边就没有新消息了，没有达到 32K 的 batch.size，这种情况下，总不能让消息一直等待达到 batch.size 后再发送吧，所以配置 linger.ms 也需要把消息发送到 kafka 集群中去。

### buffer.memory 缓冲区大小
当我们的 sender 线程处理非常缓慢，而生产的数据的速度很快时，我们中间的缓冲区如果容量不够 ，生产者就无法再继续生产数据了，所以我们有必要把缓冲区的内存调大一点，缓冲区默认大小为 32M，基本是合理的。

### compression.type 压缩方式
是否在发送前压缩数据，默认是none，不压缩

### max.block.ms
### max.request.size 最大消息大小
这个参数用来控制发送出去的消息的大小，默认是1048576字节，也就1M，这个一般太小了，很多消息可能都会超过1mb的大小，所以需要自己优化调整，把它设置更大一些（企业一般设置成10M），不然程序跑的好好的突然来了一条2M的消息，系统就报错了

### request.timeout.ms 请求超时
发送一个请求出去之后，他有一个超时的时间限制，默认是30秒，如果30秒都收不到响应（也就是上面的回调函数没有返回），那么就会认为异常，会抛出一个 TimeoutException 来让我们进行处理。如果网络不好，要适当调整此参数。


### unclean.leader.election.enable
表示当该分区所有副本代理都下线的时候，Kafka 会选择第一个上线的代理作为 Leader，而不管它下线之前是否在 ISR 中，那么如果这个新 leader 下线之前并不是 leader 或者不在 ISR 中，有一部分消息会丢失了。我们设置成 false，可以保证非 ISR 节点不能参与选举。